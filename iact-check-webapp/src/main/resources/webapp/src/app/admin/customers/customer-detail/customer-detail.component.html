<div *ngIf="this.customerFormGroup">
  <div class="display-flex-space-between margin-bottom-after-title">
    <div>
      <h1 *ngIf="this.action === 'create'">{{'CUSTOMERS.ADD_CUSTOMER' | translate}}</h1>
      <h1 *ngIf="this.action === 'edit'">{{'CUSTOMERS.EDIT_CUSTOMER' | translate}}</h1>
    </div>
    <div>
      <button mat-stroked-button (click)="this.showCustomerDeletionDialog()" *ngIf="this.action === 'edit'"
              style="margin-right: 10px;">
        <mat-icon>delete</mat-icon>
        {{'SHARED.DELETE' | translate}}
      </button>
      <button mat-stroked-button (click)="this.save()" [disabled]="this.customerFormGroup.invalid">
        <mat-icon>save</mat-icon>
        {{'SHARED.SAVE' | translate}}
      </button>
    </div>
  </div>

  <form [formGroup]="this.customerFormGroup">
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>{{'CUSTOMERS.NAME' | translate}}</mat-label>
      <mat-error>
        {{'CUSTOMERS.ERRORS.MISSING_NAME' | translate}}
      </mat-error>
      <label>
        <input matInput [placeholder]="'CUSTOMERS.PLACEHOLDER.NAME' | translate" formControlName="name" required/>
      </label>
    </mat-form-field>
    <br>
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>{{'CUSTOMERS.PRIMARY_COLOUR' | translate}}</mat-label>
      <mat-error>
        {{'CUSTOMERS.ERRORS.MISSING_OR_INVALID_PRIMARY_COLOUR' | translate}}
      </mat-error>
      <label>
        <input matInput [ngxMatColorPicker]="primaryColourPicker" formControlName="primaryColour"
               [placeholder]="'CUSTOMERS.PLACEHOLDER.PRIMARY_COLOUR' | translate" required>
      </label>
      <ngx-mat-color-toggle matSuffix [for]="primaryColourPicker"></ngx-mat-color-toggle>
      <ngx-mat-color-picker #primaryColourPicker></ngx-mat-color-picker>
    </mat-form-field>
    <br>
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>{{'CUSTOMERS.ACCENT_COLOUR' | translate}}</mat-label>
      <mat-error>
        {{'CUSTOMERS.ERRORS.MISSING_OR_INVALID_ACCENT_COLOUR' | translate}}
      </mat-error>
      <label>
        <input matInput [ngxMatColorPicker]="accentColourPicker" formControlName="accentColour"
               [placeholder]="'CUSTOMERS.PLACEHOLDER.ACCENT_COLOUR' | translate" required>
      </label>
      <ngx-mat-color-toggle matSuffix [for]="accentColourPicker"></ngx-mat-color-toggle>
      <ngx-mat-color-picker #accentColourPicker></ngx-mat-color-picker>
    </mat-form-field>

    <div class="half-width" *ngIf="this.isSuperUser">
      <h3>{{'CUSTOMERS.USERS_WITH_ACCESS' | translate}}</h3>
      <table mat-table [dataSource]="this.keycloakUsersDatasource" class="full-width">
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef>{{'USER.USERNAME' | translate}}</th>
          <td mat-cell *matCellDef="let element"> {{element.username}} </td>
        </ng-container>

        <ng-container matColumnDef="hasAccess">
          <th mat-header-cell *matHeaderCellDef style="text-align: right">{{'CUSTOMERS.HAS_ACCESS' | translate}}</th>
          <td mat-cell *matCellDef="let element" style="text-align: right;">
            <mat-checkbox [checked]="this.isUserInUsersWithAccess(element)"
                          [disabled]="this.isUserSuperUser(element)"
                          [matTooltip]="'CUSTOMERS.TOOLTIPS.USER_IS_SUPERUSER' | translate"
                          [matTooltipDisabled]="!this.isUserSuperUser(element)"
                          (change)="this.addOrRemoveUserFromUsersWithAccess(element)"></mat-checkbox>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="this.displayedColumnsUsersWithAccess"></tr>
        <tr mat-row *matRowDef="let row; columns: this.displayedColumnsUsersWithAccess;"></tr>
      </table>

      <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons
                     (page)="this.getAdditionalUserInfoForVisibleUsers($event.pageIndex, $event.pageSize)"></mat-paginator>
    </div>
  </form>
</div>
